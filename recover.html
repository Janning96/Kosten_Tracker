
<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Kosten-Tracker • Recovery</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto; background:#0b1220; color:#e5e7eb; margin:0; padding:24px}
    .card{max-width:700px; margin:0 auto; background:#111827; border:1px solid #1f2937; border-radius:14px; padding:18px}
    h1{margin:0 0 8px; font-size:22px}
    button{padding:10px 14px; border-radius:12px; border:1px solid #1f2937; background:#22c55e; color:#052e16; font-weight:600; font-size:16px; cursor:pointer}
    pre{white-space:pre-wrap; background:#0b1220; padding:10px; border-radius:8px; border:1px dashed #1f2937}
  </style>
</head>
<body>
  <div class="card">
    <h1>Recovery‑Modus</h1>
    <p>Dieser Vorgang löscht Service‑Worker & Caches dieser Domain und lädt die App anschließend frisch.</p>
    <button id="run">Jetzt bereinigen</button>
    <pre id="log"></pre>
  </div>
<script>
(async function(){
  const log = (t)=>{ const el=document.getElementById('log'); el.textContent += t + "\n"; };
  async function cleanup(){
    log("Starte Bereinigung …");
    try{
      if('serviceWorker' in navigator){
        const regs = await navigator.serviceWorker.getRegistrations();
        for (const r of regs){ await r.unregister(); log("SW unregistered: " + (r?.scope||'')); }
      }
    }catch(e){ log("SW-Fehler: " + e); }
    try{
      if(window.caches && caches.keys){
        const ks = await caches.keys();
        for (const k of ks){ await caches.delete(k); log("Cache gelöscht: " + k); }
      }
    }catch(e){ log("Cache-Fehler: " + e); }
    log("Bereinigung abgeschlossen. Lade App neu …");
    const u = new URL('./index.html', location.href);
    u.searchParams.set('reloaded', Date.now().toString());
    location.replace(u.toString());
  }
  document.getElementById('run').addEventListener('click', cleanup);
})();
</script>
</body>
</html>
